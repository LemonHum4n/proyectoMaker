<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pedir hora</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <link rel="stylesheet" href="{{url_for('static',filename='css/estilo_reserva.css')}}">

</head>
<body>
    <div>

        <header>
            <h1>Pedir Reserva</h1>
        </header>
        <form class="" novalidate>
            
            <form action="/proceso_formu" method="post">
                
                
                <section class="d-flex">
                    <div class="div_rut">
                        <h5>Rut:</h5>
                        <input type="text" name="rut" class="form-control" placeholder="11111111-1" id="validationRut" required>
                    </div>

                    
                    <div class="div_nombre">
                        <h5>Nombre:</h5>
                        <input type="text" name="nombre" class="form-control" placeholder="Ingrese su nombre" id="validationName" required>
                        <div class="invalid-feedback">
                            Porfavor ingrese su nombre.
                        </div>
                    </div>
                    <div class="div_apellido">
                        <h5>Apellido:</h5>
                        <input type="text" name="apellido" class="form-control" placeholder="Ingrese su apellido" id="validationLastName" required>
                        <div class="invalid-feedback">
                            Porfavor ingrese su apellido.
                        </div>
                    </div>
                    <div class="div_gmail">
                        <h5>Gmail:</h5>
                        <input type="text" name="gmail" class="form-control" placeholder="ejemplo@example.com" id="validationGmail" required>
                    </div>

                </section>
                <section class="d-flex justify-content-between">
                    <div class="div_tipo">
                        <h5>Tipo visita:</h5>
                        <select name="tipo_visita" class="form-select form-select-sm" id="idvisita">
                            <option value="Estudiante">Estudiante</option>
                            <option value="Profesor">Profesor</option>
                            <option value="Apoderado">Apoderado</option>
                            <option value="Visita">Visita</option>
                            <option value="Otro" selected>Otro</option>
                        </select>
                    </div>
                    <div class="div_zona">
                        <h5>Zona:</h5>
                        <select name="zona" id="idzona" class="form-select form-select-sm">
                            <option value="Impresora 3D">Impresora 3D</option>
                            <option value="Router CNC">Router CNC</option>
                            <option value="Cortadora Laser">Cortadora laser</option>
                            <option value="Clase capacitacion">Clase capacitacion</option>
                            <option value="Sala de clases">Sala de clases</option>
                            <option value="Taller">Taller</option>
                            <option value="Domo de batalla robotica">Domo de batalla robotica</option>
                        </select>
                    </div>
                    

                    <div class="div_fecha">
                        <h5>Fecha y hora:</h5>
                        <div class="d-flex align-items-center">
                            <input class="form-control"
                                type="date"
                                id="start"
                                name="fecha"
                                value=""
                                />
                            <input class="form-control" type="time" name="hora" value="08:00" min="08:00" max="18:00">
                        </div>
                    </div>

                    <script> //Necesario para poner que el minimo del dia sea hoy y no deje seleccionar dias anteriores, al igual
                        //que no deje seleccionar sabados y domingos
                        const dateInput = document.getElementById('start'); //Obtener fecha del input
                    
                        const today = new Date();
                        const yyyy = today.getFullYear();
                        const mm = String(today.getMonth() + 1).padStart(2, '0'); // Obtener el mes con los dos digitos
                        const dd = String(today.getDate()).padStart(2, '0'); // Lo mismo de arriba, pero con el dia
                        const todayFormatted = `${yyyy}-${mm}-${dd}`; //Formado de año-mes-dia
                        dateInput.min = todayFormatted;
                    
                        // Previene que el usuario seleccione sabado y domingo
                        dateInput.addEventListener('input', function () {
                            const selectedDate = new Date(this.value);
                            const day = selectedDate.getDay(); // Obtenemos el dia seleccionado, si 6 es Domingo y 5 es Sábado
                    
                            if (day === 5 || day === 6) {
                                alert('No se permiten reservas los fines de semana (sábados y domingos).');
                                this.value = ''; // Limpia el valor del input
                            }
                        });

                        
                    </script>

                    <!-- <script>
                        const form = document.querySelector('form');
                        const fechaInput = document.querySelector('input[name="fecha"]');
                        const horaInput = document.querySelector('input[name="hora"]');

                        form.addEventListener('submit', async (event) => {
                            event.preventDefault(); // Evita el envío del formulario

                            const fecha = fechaInput.value;
                            const hora = horaInput.value;

                            if (!fecha || !hora) {
                                alert('Por favor, seleccione una fecha y hora.');
                                return;
                            }

                            // Verificar disponibilidad del horario
                            try {
                                const response = await fetch('/verificar_horario', {
                                    method: 'POST',
                                    headers: {
                                        'Content-Type': 'application/json'
                                    },
                                    body: JSON.stringify({ fecha, hora })
                                });

                                const data = await response.json();

                                if (!data.disponible) {
                                    alert('El horario seleccionado ya está ocupado. Por favor, elija otro.');
                                } else {
                                    form.submit(); // Enviar el formulario si el horario está disponible
                                }
                            } catch (error) {
                                console.error('Error al verificar el horario:', error);
                                alert('Hubo un problema al verificar el horario. Inténtelo de nuevo más tarde.');
                            }
                        });
                    </script> -->
                    
                </section>

                <footer>
                    <input type="submit" value="Enviar reserva" id="input_enviar">
                    <form action="/eliminar_reserva" method="post">
                        <input type="submit" value="Eliminar reserva" id="input_eliminar">
                    </form>
                </footer>
            </form>
        </form>
        
    </div>
</body>
</html>